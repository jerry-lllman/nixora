# å‘å¸ƒæ¶æ„æ¼”è¿›è§„åˆ’

æœ¬æ–‡æ¡£è§„åˆ’äº† Nixora ç”»å¸ƒå‘å¸ƒåŠŸèƒ½çš„ä¸¤é˜¶æ®µæ¶æ„æ¼”è¿›è·¯å¾„ã€‚

## ğŸ“Š æ¶æ„å¯¹æ¯”æ€»è§ˆ

| ç»´åº¦         | MVP é˜¶æ®µï¼ˆå…±äº«è¿è¡Œæ—¶ï¼‰        | å…¨é¢ç‹¬ç«‹åŒ–é˜¶æ®µ                  |
| ------------ | ----------------------------- | ------------------------------- |
| **ç›®æ ‡ç”¨æˆ·** | ä¸­å°ä¼ä¸šã€ä¸ªäººåˆ›ä½œè€…          | å¤§å‹ä¼ä¸šã€æœ‰åˆè§„è¦æ±‚çš„å®¢æˆ·      |
| **éƒ¨ç½²æ¨¡å¼** | æ‰€æœ‰å®¢æˆ·å…±äº«ä¸€ä¸ª Next.js åº”ç”¨ | æ¯ä¸ªç”»å¸ƒç”Ÿæˆç‹¬ç«‹çš„ Next.js é¡¹ç›® |
| **æ•°æ®æº**   | æ•°æ®åº“é©±åŠ¨ï¼ˆå®æ—¶è¯»å–ï¼‰        | æ„å»ºæ—¶ç”Ÿæˆï¼ˆç‰ˆæœ¬é”å®šï¼‰          |
| **ç»„ä»¶æ›´æ–°** | å³æ—¶ç”Ÿæ•ˆï¼ˆæ‰€æœ‰ç”»å¸ƒåŒæ­¥æ›´æ–°ï¼‰  | éœ€è¦é‡æ–°å‘å¸ƒï¼ˆç‰ˆæœ¬éš”ç¦»ï¼‰        |
| **æˆæœ¬**     | ä½ï¼ˆå•ä¸€éƒ¨ç½²ï¼‰                | é«˜ï¼ˆå¤šå®ä¾‹éƒ¨ç½² + CI/CDï¼‰        |
| **å¼€å‘é€Ÿåº¦** | å¿«ï¼ˆ3-5å¤©ï¼‰                   | æ…¢ï¼ˆ2-3å‘¨ï¼‰                     |
| **é€‚ç”¨è§„æ¨¡** | < 100 å®¢æˆ·                    | > 100 å®¢æˆ·æˆ–æœ‰ä¼ä¸šéœ€æ±‚          |

---

## ğŸš€ ç¬¬ä¸€é˜¶æ®µï¼šMVP - å…±äº«è¿è¡Œæ—¶æ¶æ„

### æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è®¿é—®                              â”‚
â”‚        https://preview.nixora.com/c/[canvasId]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         apps/preview (Next.js App Router)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  app/c/[canvasId]/page.tsx                 â”‚         â”‚
â”‚  â”‚  â”œâ”€â”€ ä» API è·å– canvas æ•°æ®                â”‚         â”‚
â”‚  â”‚  â”œâ”€â”€ æ£€æŸ¥ isPublished çŠ¶æ€                  â”‚         â”‚
â”‚  â”‚  â””â”€â”€ æ¸²æŸ“ç»„ä»¶æ ‘                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  components/ComponentRenderer.tsx          â”‚         â”‚
â”‚  â”‚  â”œâ”€â”€ ç»„ä»¶ç±»å‹æ˜ å°„                           â”‚         â”‚
â”‚  â”‚  â”œâ”€â”€ Props åŠ¨æ€æ³¨å…¥                         â”‚         â”‚
â”‚  â”‚  â””â”€â”€ ä» @nixora/ui åŠ è½½ç»„ä»¶                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              apps/api (NestJS)                          â”‚
â”‚  GET /api/canvas/:id/public                             â”‚
â”‚  â”œâ”€â”€ æŸ¥è¯¢ Canvas è¡¨                                      â”‚
â”‚  â”œâ”€â”€ éªŒè¯ isPublished = true                            â”‚
â”‚  â””â”€â”€ è¿”å› components (JSONB)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PostgreSQL - Canvas è¡¨                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ id: uuid                                â”‚            â”‚
â”‚  â”‚ title: string                           â”‚            â”‚
â”‚  â”‚ components: jsonb                       â”‚            â”‚
â”‚  â”‚ isPublished: boolean                    â”‚            â”‚
â”‚  â”‚ userId: uuid                            â”‚            â”‚
â”‚  â”‚ publishedAt: timestamp                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **å¿«é€Ÿè¿­ä»£**

- ç»„ä»¶åº“æ›´æ–°åï¼Œæ‰€æœ‰å·²å‘å¸ƒçš„ç”»å¸ƒè‡ªåŠ¨ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬
- ä¿®å¤ bug æ— éœ€é‡æ–°å‘å¸ƒæ‰€æœ‰ç”»å¸ƒ

âœ… **ä½æˆæœ¬**

- å•ä¸€ Next.js éƒ¨ç½²ï¼ˆ1ä¸ªæœåŠ¡å™¨å³å¯ï¼‰
- æ— éœ€ CI/CD æµæ°´çº¿
- æ— éœ€å­˜å‚¨å¤§é‡ç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶

âœ… **ç®€å•ç»´æŠ¤**

- ç»Ÿä¸€çš„æ—¥å¿—å’Œç›‘æ§
- ç»Ÿä¸€çš„æ€§èƒ½ä¼˜åŒ–
- ç»Ÿä¸€çš„å®‰å…¨æ›´æ–°

âœ… **çµæ´»æ€§**

- æ”¯æŒ A/B æµ‹è¯•ï¼ˆæ ¹æ®ç”¨æˆ·æ ‡ç­¾è¿”å›ä¸åŒç‰ˆæœ¬ï¼‰
- æ”¯æŒåŠ¨æ€å†…å®¹æ³¨å…¥
- æ”¯æŒå®æ—¶æ•°æ®ç»‘å®š

### å…³é”®å®ç°è¦ç‚¹

#### 1. æ‰©å±• Canvas å®ä½“

```typescript
// apps/api/src/canvas/entities/canva.entity.ts
@Column({ default: false })
isPublished!: boolean;

@Column({ nullable: true })
publishedAt?: Date;

@Column({ nullable: true })
publishUrl?: string;
```

#### 2. æ·»åŠ å…¬å¼€è®¿é—® API

```typescript
// apps/api/src/canvas/canvas.controller.ts
@Get(':id/public')
async getPublic(@Param('id') id: string) {
  return this.canvasService.findPublished(id);
}
```

#### 3. Preview åº”ç”¨æ ¸å¿ƒé¡µé¢

```typescript
// apps/preview/app/c/[canvasId]/page.tsx
export const revalidate = 3600; // ISR: æ¯å°æ—¶é‡æ–°ç”Ÿæˆ

export default async function CanvasPage({ params }) {
  const canvas = await getPublishedCanvas(params.canvasId);
  return <CanvasRenderer canvas={canvas} />;
}
```

#### 4. ç»„ä»¶æ¸²æŸ“å™¨

```typescript
// apps/preview/components/CanvasRenderer.tsx
const componentMap = {
  'NixoraButton': NixoraButton,
  // ... å…¶ä»–ç»„ä»¶
};

export function CanvasRenderer({ canvas }) {
  return canvas.components.map(comp => {
    const Component = componentMap[comp.componentType];
    return <Component key={comp.instanceId} {...comp.props} />;
  });
}
```

#### 5. On-Demand Revalidation

```typescript
// apps/preview/app/api/revalidate/route.ts
export async function POST(request) {
  const { canvasId } = await request.json();
  revalidatePath(`/c/${canvasId}`);
  return NextResponse.json({ revalidated: true });
}

// API å‘å¸ƒæ—¶è§¦å‘
await fetch(`${PREVIEW_URL}/api/revalidate`, {
  method: "POST",
  body: JSON.stringify({ canvasId })
});
```

### éƒ¨ç½²å»ºè®®

**æ¨èæ–¹æ¡ˆ**: Vercelï¼ˆé›¶é…ç½®ï¼Œè‡ªåŠ¨ HTTPS + CDNï¼‰

```bash
cd apps/preview
vercel --prod
```

**è‡ªæ‰˜ç®¡æ–¹æ¡ˆ**: Docker + Nginx

```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY . .
RUN pnpm install && pnpm build
CMD ["pnpm", "start"]
```

### MVP é˜¶æ®µçš„å±€é™æ€§

âš ï¸ **ä¸é€‚åˆçš„åœºæ™¯**ï¼š

- å®¢æˆ·éœ€è¦ç‰ˆæœ¬é”å®šï¼ˆç»„ä»¶æ›´æ–°å¯èƒ½ç ´åå·²å‘å¸ƒçš„é¡µé¢ï¼‰
- éœ€è¦ç‰©ç†éš”ç¦»ï¼ˆåˆè§„è¦æ±‚ï¼‰
- éœ€è¦ç‹¬ç«‹éƒ¨ç½²åˆ°å®¢æˆ·çš„ç§æœ‰äº‘
- éœ€è¦æ·±åº¦å®šåˆ¶æ¯ä¸ªå®¢æˆ·çš„å®ç°
- è¶…è¿‡ 1000 ä¸ªé«˜æµé‡ç”»å¸ƒ

---

## ğŸ¢ ç¬¬äºŒé˜¶æ®µï¼šå…¨é¢ç‹¬ç«‹åŒ–æ¶æ„

### æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·ç‚¹å‡»"å‘å¸ƒ"                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          apps/api - Canvas Service                   â”‚
â”‚  async publish(canvasId, userId) {                   â”‚
â”‚    1. æ ‡è®° isPublished = true                        â”‚
â”‚    2. è°ƒç”¨ ProjectGenerator ç”Ÿæˆé¡¹ç›®                 â”‚
â”‚    3. è§¦å‘ CI/CD éƒ¨ç½²æµæ°´çº¿                          â”‚
â”‚    4. è¿”å›éƒ¨ç½² URL                                   â”‚
â”‚  }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ProjectGenerator Service                      â”‚
â”‚  1. åˆ›å»ºé¡¹ç›®ç›®å½•: exports/canvas-{id}/               â”‚
â”‚  2. ç”Ÿæˆ package.jsonï¼ˆé”å®šç»„ä»¶ç‰ˆæœ¬ï¼‰                â”‚
â”‚  3. ç”Ÿæˆ Next.js é¡µé¢ä»£ç                             â”‚
â”‚  4. ç”Ÿæˆé…ç½®æ–‡ä»¶                                      â”‚
â”‚  5. åˆå§‹åŒ– Git ä»“åº“                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             exports/canvas-abc123/                   â”‚
â”‚  package.json  â† é”å®š @nixora/button@1.0.0           â”‚
â”‚  app/page.tsx  â† ç”Ÿæˆçš„ React ä»£ç                    â”‚
â”‚  next.config.js                                      â”‚
â”‚  Dockerfile / vercel.json                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CI/CD æµæ°´çº¿                             â”‚
â”‚  GitHub Actions / Jenkins                            â”‚
â”‚  1. pnpm install                                     â”‚
â”‚  2. pnpm build                                       â”‚
â”‚  3. éƒ¨ç½²åˆ° Vercel / AWS / å®¢æˆ·ç§æœ‰äº‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç‹¬ç«‹éƒ¨ç½²çš„ Next.js åº”ç”¨                       â”‚
â”‚  https://canvas-abc123.nixora.com                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **ç‰ˆæœ¬éš”ç¦»**

- æ¯ä¸ªç”»å¸ƒé”å®šç‰¹å®šç‰ˆæœ¬çš„ç»„ä»¶
- ç»„ä»¶åº“æ›´æ–°ä¸å½±å“å·²å‘å¸ƒçš„ç”»å¸ƒ
- å®¢æˆ·å¯ä»¥é€‰æ‹©ä½•æ—¶å‡çº§

âœ… **å®¢æˆ·éš”ç¦»**

- æ¯ä¸ªç”»å¸ƒç‹¬ç«‹éƒ¨ç½²
- äº’ä¸å½±å“ï¼ˆæ€§èƒ½ã€å®‰å…¨ã€èµ„æºï¼‰
- æ”¯æŒéƒ¨ç½²åˆ°å®¢æˆ·æŒ‡å®šçš„ç¯å¢ƒ

âœ… **æ·±åº¦å®šåˆ¶**

- ç”Ÿæˆåå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä»£ç 
- å¯ä»¥é›†æˆå®¢æˆ·ä¸“å±é€»è¾‘
- å¯ä»¥ç™½æ ‡ï¼ˆæ›¿æ¢å“ç‰Œï¼‰

âœ… **åˆè§„æ€§**

- ç‰©ç†éš”ç¦»
- ç‹¬ç«‹çš„å®‰å…¨å®¡è®¡
- æ»¡è¶³ ISO/HIPAA/SOC2 ç­‰è¦æ±‚

### å…³é”®å®ç°è¦ç‚¹

#### 1. ç»„ä»¶åº“æ‹†åˆ†ä¸ºç‹¬ç«‹ npm åŒ…

**å½“å‰ç»“æ„**:

```
packages/ui/src/components/
  â”œâ”€â”€ button.tsx
  â”œâ”€â”€ card.tsx
  â””â”€â”€ ...
```

**ç›®æ ‡ç»“æ„**:

```
packages/
  â”œâ”€â”€ button/
  â”‚   â”œâ”€â”€ package.json  # @nixora/button@1.0.0
  â”‚   â””â”€â”€ src/index.tsx
  â”œâ”€â”€ card/
  â”‚   â”œâ”€â”€ package.json  # @nixora/card@1.0.0
  â”‚   â””â”€â”€ src/index.tsx
  â””â”€â”€ ...
```

#### 2. é¡¹ç›®ç”Ÿæˆå™¨æ ¸å¿ƒé€»è¾‘

```typescript
// apps/api/src/generator/project-generator.service.ts
@Injectable()
export class ProjectGeneratorService {
  async generateProject(canvas: Canvas): Promise<string> {
    const projectDir = `exports/canvas-${canvas.id}`;

    // 1. åˆ†æç»„ä»¶ä¾èµ–
    const deps = this.analyzeDependencies(canvas.components);
    // { '@nixora/button': '1.0.0', '@nixora/card': '2.3.1' }

    // 2. ç”Ÿæˆ package.json
    await this.generatePackageJson(projectDir, deps);

    // 3. ç”Ÿæˆé¡µé¢ä»£ç 
    await this.generatePageCode(projectDir, canvas);

    // 4. ç”Ÿæˆé…ç½®æ–‡ä»¶
    await this.generateConfigs(projectDir);

    return projectDir;
  }

  private generatePageCode(projectDir: string, canvas: Canvas) {
    const imports = this.generateImports(canvas.components);
    const jsx = this.generateJSX(canvas.components);

    const code = `
${imports}

export default function Page() {
  return (
    <div className="min-h-screen">
      ${jsx}
    </div>
  );
}
    `.trim();

    fs.writeFileSync(`${projectDir}/app/page.tsx`, code);
  }
}
```

#### 3. éƒ¨ç½²æœåŠ¡

```typescript
// apps/api/src/generator/deployment.service.ts
@Injectable()
export class DeploymentService {
  async deploy(projectDir: string): Promise<string> {
    // åˆå§‹åŒ– Git
    await exec("git init", { cwd: projectDir });
    await exec("git add .", { cwd: projectDir });
    await exec('git commit -m "Initial"', { cwd: projectDir });

    // éƒ¨ç½²åˆ° Vercel
    const { stdout } = await exec(
      `vercel --prod --token ${VERCEL_TOKEN} --yes`,
      { cwd: projectDir }
    );

    // æå–éƒ¨ç½² URL
    const url = stdout.match(/https:\/\/[^\s]+/)?.[0];
    return url;
  }
}
```

#### 4. å‘å¸ƒæµç¨‹é›†æˆ

```typescript
// apps/api/src/canvas/canvas.service.ts
async publish(id: string, userId: string): Promise<Canvas> {
  const canvas = await this.findOne(id, userId);

  // ç”Ÿæˆé¡¹ç›®
  const projectDir = await this.projectGenerator.generateProject(canvas);

  // éƒ¨ç½²
  const deployUrl = await this.deploymentService.deploy(projectDir);

  // æ›´æ–°æ•°æ®åº“
  canvas.isPublished = true;
  canvas.publishedAt = new Date();
  canvas.publishUrl = deployUrl;
  canvas.projectPath = projectDir;

  return await this.canvasRepository.save(canvas);
}
```

#### 5. ç”Ÿæˆçš„é¡¹ç›®ç»“æ„

```
exports/canvas-abc123/
â”œâ”€â”€ package.json
â”‚   {
â”‚     "dependencies": {
â”‚       "@nixora/button": "1.0.0",  â† ç‰ˆæœ¬é”å®š
â”‚       "@nixora/card": "2.3.1",
â”‚       "next": "14.2.0"
â”‚     }
â”‚   }
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   import { NixoraButton } from '@nixora/button'
â”‚   â”‚   export default function Page() {
â”‚   â”‚     return <NixoraButton text="ç‚¹å‡»" />
â”‚   â”‚   }
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ vercel.json
â””â”€â”€ README.md
```

### ç»„ä»¶ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ

```typescript
// apps/api/src/components/component-version.entity.ts
@Entity('component_versions')
export class ComponentVersion {
  @Column()
  componentType!: string; // 'NixoraButton'

  @Column()
  packageName!: string; // '@nixora/button'

  @Column()
  version!: string; // '1.0.0'

  @Column({ default: false })
  isDeprecated!: boolean;

  @CreateDateColumn()
  publishedAt!: Date;
}

// æŸ¥è¯¢å½“å‰æœ€æ–°ç‰ˆæœ¬
async getCurrentVersion(componentType: string): Promise<string> {
  const version = await this.repo.findOne({
    where: { componentType, isDeprecated: false },
    order: { publishedAt: 'DESC' }
  });
  return version?.version || '1.0.0';
}
```

### æ•°æ®åº“æ‰©å±•

```typescript
// apps/api/src/canvas/entities/canva.entity.ts
@Column({ default: 'shared' })
deploymentType!: 'shared' | 'dedicated';

@Column({ nullable: true })
projectPath?: string; // exports/canvas-{id}

@Column({ nullable: true })
gitRepoUrl?: string;

@Column({ type: 'jsonb', nullable: true })
componentVersions?: Record<string, string>; // é”å®šçš„ç»„ä»¶ç‰ˆæœ¬
```

### å…¨é¢ç‹¬ç«‹åŒ–çš„æŒ‘æˆ˜

âš ï¸ **éœ€è¦è§£å†³çš„é—®é¢˜**ï¼š

1. **CI/CD æˆæœ¬**
   - æ¯æ¬¡å‘å¸ƒéœ€è¦ 5-10 åˆ†é’Ÿçš„æ„å»ºæ—¶é—´
   - éœ€è¦æŠ•èµ„ CI/CD åŸºç¡€è®¾æ–½

2. **å­˜å‚¨æˆæœ¬**
   - æ¯ä¸ªé¡¹ç›® ~500MBï¼ˆåŒ…å« node_modulesï¼‰
   - 1000 ä¸ªç”»å¸ƒ = 500GB å­˜å‚¨

3. **æ‰¹é‡æ›´æ–°éš¾é¢˜**
   - ç»„ä»¶æœ‰ä¸¥é‡ bug æ—¶ï¼Œå¦‚ä½•æ‰¹é‡æ›´æ–°æ‰€æœ‰é¡¹ç›®ï¼Ÿ
   - éœ€è¦æ„å»º"é‡æ–°å‘å¸ƒæ‰€æœ‰ç”»å¸ƒ"çš„å·¥å…·

4. **ç›‘æ§å¤æ‚åº¦**
   - éœ€è¦ä¸ºæ¯ä¸ªé¡¹ç›®é…ç½®ç‹¬ç«‹çš„ç›‘æ§
   - éœ€è¦èšåˆç›‘æ§é¢æ¿

---

## ğŸ”„ è¿ç§»è·¯å¾„

### ä» MVP åˆ°ç‹¬ç«‹åŒ–çš„å¹³æ»‘è¿‡æ¸¡

#### ç­–ç•¥ 1ï¼šæ¸è¿›å¼è¿ç§»

```typescript
// Canvas å®ä½“æ·»åŠ éƒ¨ç½²ç±»å‹å­—æ®µ
@Column({ default: 'shared' })
deploymentType: 'shared' | 'dedicated';

// å‘å¸ƒæ—¶æ ¹æ®ç±»å‹é€‰æ‹©ç­–ç•¥
async publish(id: string, userId: string) {
  const canvas = await this.findOne(id, userId);

  if (canvas.deploymentType === 'shared') {
    return await this.publishToSharedRuntime(canvas);
  } else {
    return await this.publishAsDedicatedProject(canvas);
  }
}
```

#### ç­–ç•¥ 2ï¼šæŒ‰å®¢æˆ·ç­‰çº§åŒºåˆ†

```typescript
// ç”¨æˆ·è¡¨æ·»åŠ ç­‰çº§å­—æ®µ
@Column({ default: 'free' })
tier: 'free' | 'pro' | 'enterprise';

// è‡ªåŠ¨é€‰æ‹©éƒ¨ç½²ç±»å‹
const deploymentType = user.tier === 'enterprise' ? 'dedicated' : 'shared';
```

#### ç­–ç•¥ 3ï¼šæŒ‰æµé‡è‡ªåŠ¨å‡çº§

```typescript
// ç›‘æ§ç”»å¸ƒæµé‡ï¼Œè¶…è¿‡é˜ˆå€¼è‡ªåŠ¨å‡çº§
if (canvas.monthlyPageViews > 1000000) {
  await this.migrateToStandalone(canvas);
}
```

---

## ğŸ“Š æˆæœ¬å¯¹æ¯”åˆ†æ

### MVP é˜¶æ®µï¼ˆå‰ 100 ä¸ªå®¢æˆ·ï¼‰

| èµ„æº         | MVP æ–¹æ¡ˆ          | ç‹¬ç«‹åŒ–æ–¹æ¡ˆ       |
| ------------ | ----------------- | ---------------- |
| **æœåŠ¡å™¨**   | $50/æœˆ (å•å° VPS) | $500/æœˆ (å¤šå®ä¾‹) |
| **å­˜å‚¨**     | 10GB              | 500GB            |
| **CI/CD**    | ä¸éœ€è¦            | $200/æœˆ          |
| **å¼€å‘æ—¶é—´** | 5 å¤©              | 20 å¤©            |
| **ç»´æŠ¤æˆæœ¬** | ä½                | é«˜               |
| **æ€»æˆæœ¬**   | ~$50/æœˆ           | ~$700/æœˆ         |

### è§„æ¨¡åŒ–é˜¶æ®µï¼ˆ1000+ å®¢æˆ·ï¼‰

| èµ„æº         | MVP æ–¹æ¡ˆ  | ç‹¬ç«‹åŒ–æ–¹æ¡ˆ |
| ------------ | --------- | ---------- |
| **æœåŠ¡å™¨**   | $500/æœˆ   | $5000/æœˆ   |
| **å­˜å‚¨**     | 100GB     | 5TB        |
| **CI/CD**    | $200/æœˆ   | $2000/æœˆ   |
| **äººåŠ›æˆæœ¬** | 1 ä¸ªè¿ç»´  | 3-5 ä¸ªè¿ç»´ |
| **æ€»æˆæœ¬**   | ~$1000/æœˆ | ~$10000/æœˆ |

---

## ğŸ¯ å†³ç­–çŸ©é˜µ

### ä½•æ—¶ä½¿ç”¨å…±äº«è¿è¡Œæ—¶ï¼ˆMVPï¼‰ï¼Ÿ

âœ… é€‚ç”¨åœºæ™¯ï¼š

- å®¢æˆ·æ•° < 100
- éƒ½æ˜¯ä¸­å°ä¼ä¸šæˆ–ä¸ªäººç”¨æˆ·
- ä¸éœ€è¦åˆè§„è®¤è¯
- å¿«é€Ÿè¿­ä»£éœ€æ±‚å¼º
- é¢„ç®—æœ‰é™

### ä½•æ—¶åˆ‡æ¢åˆ°ç‹¬ç«‹åŒ–ï¼Ÿ

âœ… è§¦å‘æ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³åˆ‡æ¢ï¼‰ï¼š

- æœ‰å¤§å‹ä¼ä¸šå®¢æˆ·ï¼ˆå¹´æ”¶å…¥ > $10Kï¼‰
- éœ€è¦é€šè¿‡ ISO/SOC2 è®¤è¯
- å®¢æˆ·è¦æ±‚éƒ¨ç½²åˆ°ç§æœ‰äº‘
- å•ä¸ªç”»å¸ƒæœˆæµé‡ > 100 ä¸‡ PV
- ç»„ä»¶ç‰ˆæœ¬é”å®šéœ€æ±‚å¼ºçƒˆ

---

## ğŸ“ å®æ–½æ£€æŸ¥æ¸…å•

### MVP é˜¶æ®µæ£€æŸ¥æ¸…å•

- [ ] Preview åº”ç”¨æ­å»ºå®Œæˆ
- [ ] ComponentRenderer å®ç°
- [ ] å…¬å¼€è®¿é—® API å®Œæˆ
- [ ] ISR ç¼“å­˜ç­–ç•¥é…ç½®
- [ ] On-Demand Revalidation å®ç°
- [ ] éƒ¨ç½²åˆ° Vercel/æœåŠ¡å™¨
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ< 1s é¦–å±åŠ è½½ï¼‰

### ç‹¬ç«‹åŒ–é˜¶æ®µæ£€æŸ¥æ¸…å•

- [ ] ç»„ä»¶åº“æ‹†åˆ†ä¸ºç‹¬ç«‹ npm åŒ…
- [ ] ProjectGenerator å®ç°
- [ ] CI/CD æµæ°´çº¿æ­å»º
- [ ] Git ä»“åº“ç®¡ç†ç³»ç»Ÿ
- [ ] ç»„ä»¶ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ
- [ ] æ‰¹é‡éƒ¨ç½²å·¥å…·
- [ ] ç›‘æ§èšåˆé¢æ¿
- [ ] æˆæœ¬æ§åˆ¶ç­–ç•¥
- [ ] å®¢æˆ·è‡ªå®šä¹‰éƒ¨ç½²æµç¨‹

---

## ğŸ”® æœªæ¥å±•æœ›

### ç¬¬ä¸‰é˜¶æ®µï¼šæ··åˆæ™ºèƒ½åŒ–ï¼ˆ2-3 å¹´åï¼‰

- **AI é©±åŠ¨çš„éƒ¨ç½²å†³ç­–**ï¼šæ ¹æ®ç”»å¸ƒç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜éƒ¨ç½²æ–¹å¼
- **è¾¹ç¼˜è®¡ç®—**ï¼šå°†çƒ­é—¨ç”»å¸ƒæ¨é€åˆ° CDN è¾¹ç¼˜èŠ‚ç‚¹
- **Serverless æ¶æ„**ï¼šæŒ‰éœ€è®¡è´¹ï¼Œé›¶æˆæœ¬èµ·æ­¥
- **å¤šç§Ÿæˆ·éš”ç¦»**ï¼šåœ¨å…±äº«è¿è¡Œæ—¶ä¸­å®ç°é€»è¾‘éš”ç¦»

---

**æœ€åæ›´æ–°**: 2025-10-15
**ç»´æŠ¤è€…**: Nixora å›¢é˜Ÿ
**ç‰ˆæœ¬**: 1.0
